<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline evaluation: Replication of Li et al 2010 • contextual</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Offline evaluation: Replication of Li et al 2010">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">contextual</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Getting started: running simulations</a>
    </li>
    <li>
      <a href="../articles/replication.html">Offline evaluation: Replication of Li et al 2010</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nth-iteration-labs/contextual">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Offline evaluation: Replication of Li et al 2010</h1>
                        <h4 class="author">Robin van Emden</h4>
            
            <h4 class="date">2018-11-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nth-iteration-labs/contextual/blob/master/vignettes/replication.Rmd"><code>vignettes/replication.Rmd</code></a></small>
      <div class="hidden name"><code>replication.Rmd</code></div>

    </div>

    
    
<p>In the current vignette, we demonstrate how <code>contextual</code> facilitates the comparison of bandit policies on big offline datasets by running a partial replication of “<a href="https://arxiv.org/abs/1003.0146">A Contextual-Bandit Approach to Personalized News Article Recommendation</a>” by Li et al 2010. This paper describes how the authors made use of offline Yahoo! click-through rate data to evaluate and compare the effectiveness of several context-free and contextual policies.</p>
<p>All source code related to this replication can be found in the package’s <code>demo/replication_li_2010</code> directory.</p>
<div id="description-of-the-data" class="section level4">
<h4 class="hasAnchor">
<a href="#description-of-the-data" class="anchor"></a>Description of the data</h4>
<p>The dataset used in the Li et al 2010 paper has been made available at the Yahoo! lab’s website (At <a href="https://webscope.sandbox.yahoo.com/catalog.php?datatype=r&amp;did=49" class="uri">https://webscope.sandbox.yahoo.com/catalog.php?datatype=r&amp;did=49</a>). It contains the click-through rate from the Today news module on Yahoo!’s homepage over the course of several days in May 2009, totaling 45,811,883 separate events.</p>
<p>Each row in the dataset describes an interaction event (click or no click) of users shown a randomly chosen article. Each of these events contains the following information:</p>
<ul>
<li>The ID’s of each of a varying subset of 19 to 25 articles selected by human editors from a pool of 217 articles.</li>
<li>The ID of an article randomly chosen from the subset defined in 1. and positioned at the story position (that is, at the top of the Yahoo!’s website’s “Today” segment).</li>
<li>Six features per article for each of the articles shown.</li>
<li>Six user features (with a distinct user for each event).</li>
<li>Whether or not a user clicked on the article at the story position.</li>
</ul>
<p>That is, for each event <span class="math inline">\(t\)</span> an article represents one of <span class="math inline">\(A\)</span> actions (that is, one of the 271 articles observed within the course of the 10 days covered by the dataset) with <span class="math inline">\(\mathbb{R}^6\)</span> features <span class="math inline">\(X_{t,a}\)</span> per arm, and another <span class="math inline">\(\mathbb{R}^6\)</span> features <span class="math inline">\(X_{t,u}\)</span> per unique visitor. Together, the flattened outer product of the user and article feature vector creates a <span class="math inline">\(\mathbb{R}^{36}\)</span> feature vector <span class="math inline">\(X_t\)</span> for each user and article pair with outcome value or reward <span class="math inline">\(r_t\)</span> click (1) or no click (0). For the further details on the data structure and the general setup of the experiment, we refer the reader to the original Li et al 2010 paper.</p>
</div>
<div id="data-import" class="section level4">
<h4 class="hasAnchor">
<a href="#data-import" class="anchor"></a>Data import</h4>
<p>As the Yahoo data is too large to fit into memory, we imported most (The first two CSV files representing the first two days of the Yahoo! dataset are somewhat irregular, as they contain articles with more than six features. We, therefore, decided to leave these two CSV files out of our import, resulting in 37,450,196 imported events, instead of the 45,811,883 events used in the original paper) of the dataset’s CSV files into a <code>MonetDB</code> instance—a fast, open source column-oriented database management system with excellent R support (MonetDB can be downloaded at <a href="https://www.monetdb.org/" class="uri">https://www.monetdb.org/</a>). The import script, example import scripts for several other databases (<code>MySQL</code>, <code>SQLite</code>, <code>Postgresql</code>) and all other source code related to this replication can be found in the package’s <code>demo/replication_li_2010</code> directory.</p>
</div>
<div id="custom-bandit-and-policies" class="section level4">
<h4 class="hasAnchor">
<a href="#custom-bandit-and-policies" class="anchor"></a>Custom bandit and policies</h4>
<p>With the Yahoo! data imported into the MonetDB server, the next step was to create a custom offline <code>YahooBandit</code> plus seven <code>Policy</code> subclasses implementing the policies described in the Li et al 2010 paper. Though most of these policies were already implemented in <code>contextual</code>, the fact that only a subset of all 271 articles or arms are shown to a visitor at a time meant we needed to make some minor changes to <code>contextual</code>’s exisiting classes to make the policies run smoothly on a continually shifting pool of active arms.</p>
<p>To facilitate these shifting arms, <code>YahooBandit</code> makes use of an <code>self$arm_lookup</code> table listing all 271 arms. This table enables the bandit to look up the currently active arms’ indexes from the shifting set of article ID’s as specified in the dataset for each time step <span class="math inline">\(t\)</span>, and return these indexes to the policies under evaluation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">    get_context =<span class="st"> </span><span class="cf">function</span>(index) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">      ...</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">      <span class="co"># Retrieve the index of all arms this row/event.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">      arm_indices_this_event  &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">10</span>, <span class="dv">184</span>, <span class="dt">by =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">      article_ids             &lt;-<span class="st"> </span>row[arm_indices_this_event]</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">      article_ids             &lt;-<span class="st"> </span>article_ids[<span class="op">!</span><span class="kw">is.na</span>(article_ids)]</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">      article_ids             &lt;-<span class="st"> </span><span class="kw">match</span>(article_ids,self<span class="op">$</span>arm_lookup)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">      ...</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">      context &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">        <span class="dt">k =</span> self<span class="op">$</span>k,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">        <span class="dt">d =</span> self<span class="op">$</span>d,</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">        <span class="dt">unique =</span> self<span class="op">$</span>unique, <span class="co"># Indexes of disjoint arms (user features)</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">        <span class="dt">shared =</span> self<span class="op">$</span>shared, <span class="co"># Indexes of shared arms (article features)</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        <span class="dt">arms =</span> article_ids,   <span class="co"># Indexes of arms this event.</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">        <span class="dt">X =</span> X</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">      )</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">    }</a></code></pre></div>
<p>The policy classes then use this information to select and update only the currently active subset of arms. For instance, in <code>YahooEpsilonGreedyPolicy</code>’s <code><a href="../reference/Policy.html">get_action()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">    get_action =<span class="st"> </span><span class="cf">function</span>(t, context) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">      <span class="cf">if</span> (<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&gt;</span><span class="st"> </span>self<span class="op">$</span>epsilon) {</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">        <span class="co"># get the max of context$arms *currently in play*</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">        max_index          &lt;-<span class="st"> </span>context<span class="op">$</span>arms[<span class="kw">max_in</span>(theta<span class="op">$</span>mean[context<span class="op">$</span>arms])]</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">        self<span class="op">$</span>action<span class="op">$</span>choice &lt;-<span class="st"> </span>max_index</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">        <span class="co"># sample from the arms *currently in play*</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">        self<span class="op">$</span>action<span class="op">$</span>choice &lt;-<span class="st"> </span><span class="kw">sample</span>(context<span class="op">$</span>arms, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">      }</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">      self<span class="op">$</span>action</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    }</a></code></pre></div>
<p>On completing the implementation of the aforementioned seven custom policy subclasses (<code>Random</code>, <code>EGreedy</code>, <code>EGreedySeg</code>, <code>LinUCBDis</code>, <code>LinUCBHyb</code>, <code>UCB1</code> and <code>UCB1Seg</code>) we then assigned them to six simulations—one for each of the six (0, 30, 20, 10, 5 and 1 percent) levels of sparsity defined in the original paper. This resulted in <span class="math inline">\(7\times6=42\)</span> Agents, which were then run on the offline dataset as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">simulations             &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">horizon                 &lt;-<span class="st"> </span><span class="fl">37.45e6</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">...</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbConnect">dbConnect</a></span>(<span class="kw">MonetDB.R</span>(), <span class="dt">host=</span>monetdb_host, <span class="dt">dbname=</span>monetdb_dbname,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                                   <span class="dt">user=</span>monetdb_user, <span class="dt">password=</span>monetdb_pass)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw">message</span>(<span class="kw">paste0</span>(<span class="st">"MonetDB: connection to '"</span>,<span class="kw">dbListTables</span>(con),<span class="st">"' succesful!"</span>))</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">arm_lookup_table &lt;-</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">  </span><span class="kw">as.matrix</span>(DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbGetQuery">dbGetQuery</a></span>(con, <span class="st">"SELECT DISTINCT article_id FROM yahoo"</span>))</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">arm_lookup_table &lt;-<span class="st"> </span><span class="kw">rev</span>(<span class="kw">as.vector</span>(arm_lookup_table))</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">bandit &lt;-<span class="st"> </span>YahooBandit<span class="op">$</span><span class="kw">new</span>(<span class="dt">k =</span> 217L, <span class="dt">unique =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>), <span class="dt">shared =</span> <span class="kw">c</span>(<span class="dv">7</span><span class="op">:</span><span class="dv">12</span>),</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">                          <span class="dt">arm_lookup =</span> arm_lookup_table, <span class="dt">host =</span> monetdb_host,</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">                          <span class="dt">dbname =</span> monetdb_dbname, <span class="dt">user =</span> monetdb_user,</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">                          <span class="dt">password =</span> monetdb_pass, <span class="dt">buffer_size =</span> buffer_size)</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">agents &lt;-</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="st">  </span><span class="kw">list</span> (Agent<span class="op">$</span><span class="kw">new</span>(YahooLinUCBDisjointPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.2</span>),</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">                  bandit, <span class="dt">name =</span> <span class="st">"LinUCB Dis"</span>,  <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">        Agent<span class="op">$</span><span class="kw">new</span>(YahooLinUCBHybridPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.2</span>),</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">                  bandit, <span class="dt">name =</span> <span class="st">"LinUCB Hyb"</span>,  <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">        Agent<span class="op">$</span><span class="kw">new</span>(YahooEpsilonGreedyPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">                  bandit, <span class="dt">name =</span> <span class="st">"EGreedy"</span>,     <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">        Agent<span class="op">$</span><span class="kw">new</span>(YahooEpsilonGreedySegPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">                  bandit, <span class="dt">name =</span> <span class="st">"EGreedySeg"</span>,  <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">        Agent<span class="op">$</span><span class="kw">new</span>(YahooUCB1AlphaPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.4</span>),</a>
<a class="sourceLine" id="cb3-29" data-line-number="29">                  bandit, <span class="dt">name =</span> <span class="st">"UCB1"</span>,        <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-30" data-line-number="30">        Agent<span class="op">$</span><span class="kw">new</span>(YahooUCB1AlphaSegPolicy<span class="op">$</span><span class="kw">new</span>(<span class="fl">0.4</span>),</a>
<a class="sourceLine" id="cb3-31" data-line-number="31">                  bandit, <span class="dt">name =</span> <span class="st">"UCB1Seg"</span>,     <span class="dt">sparse =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">        ...</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">        Agent<span class="op">$</span><span class="kw">new</span>(YahooRandomPolicy<span class="op">$</span><span class="kw">new</span>(),</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">                  bandit, <span class="dt">name =</span> <span class="st">"Random"</span>))</a>
<a class="sourceLine" id="cb3-35" data-line-number="35"></a>
<a class="sourceLine" id="cb3-36" data-line-number="36">simulation &lt;-<span class="st"> </span>Simulator<span class="op">$</span><span class="kw">new</span>(</a>
<a class="sourceLine" id="cb3-37" data-line-number="37">    agents,</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">    <span class="dt">simulations =</span> simulations,</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">    <span class="dt">horizon =</span> horizon,</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">    <span class="dt">do_parallel =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-41" data-line-number="41">    <span class="dt">worker_max =</span> worker_max,</a>
<a class="sourceLine" id="cb3-42" data-line-number="42">    <span class="dt">reindex =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-43" data-line-number="43">    <span class="dt">progress_file =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb3-44" data-line-number="44">    <span class="dt">include_packages =</span> <span class="kw">c</span>(<span class="st">"MonetDB.R"</span>))</a>
<a class="sourceLine" id="cb3-45" data-line-number="45"></a>
<a class="sourceLine" id="cb3-46" data-line-number="46">history  &lt;-<span class="st"> </span>simulation<span class="op">$</span><span class="kw"><a href="../reference/Simulator.html">run</a></span>()</a>
<a class="sourceLine" id="cb3-47" data-line-number="47">...</a></code></pre></div>
</div>
<div id="results" class="section level4">
<h4 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h4>
<p>We were able to complete the full <span class="math inline">\(7\times6=42\)</span> agent simulation over all of the 37,450,196 events in our database within 22 hours on a 64 core Intel Xeon Unbuntu server with 256GB of memory. We then proceeded to analyse the results of the first 4.7 million events (following the original paper, representing about a day worth of events) to reproduce Li et al 2010’s Figure 4b: “CTRs in evaluation data with varying data sizes in the learning bucket.”. Just like the original paper, the replicated figure below reports each algorithm’s relative CTR for all of the defined data sparsity levels, that is, each algorithm’s CTR divided by the random policy’s CTR.</p>
<p><img src="replication-fig-1.png" style="width:98.0%"></p>
<p><em>Replication of Figure 4b “CTRs in evaluation data with varying data sizes in the learning bucket.” from Li et al 2010. The plots represent the click through rates for different policies after one day of learning for each of six different levels of sparsity.</em></p>
<p>As can be observed in the next figure, after one day of learning (on the Yahoo! dataset’s day three), the conclusions of the original paper still stand. First, features again prove to be of use at all levels of sparsity, as LinUCB policies outperform the others consistently. Second, UCB policies generally outperform <span class="math inline">\(\epsilon\)</span>-greedy ones. And third, Hybrid LinUCB again shows benefits when the data is small, as can be deduced from it doing better in the 1% bucket. Still, as we started our simulation on the third day instead of the first, our results are close to, but not quite the same as those reported in the original paper. Particularly the third conclusion, that of the relative advantage of Hybrid LinUCB with sparse data, seems to be slightly less convincing in our figure.</p>
<p>So we decided to run a simulation that continued to learn beyond the first day for the sparse (1%) data condition to test whether Hybrid LinUCB’s reported relative advantage would prove stable over time.</p>
<p><img src="replication-fig-2.png" style="width:98.0%"></p>
<p><em>A plot of the cumulative reward rate (equals click-through rate) for EGreedy, EGreedySeg, LinUCB Dis, LinUCB Hyb, UCB1, and UCB1Seg policies over eight days of events from the Yahoo dataset at 1% sparsity. The dotted lines represent blocks consisting of 24 hours worth of data—the lines are not equidistant as the number of data points of these 24 hours differs per block. The plot’s sinusoidal wave pattern reflects visitors’ overall average cyclical daily waxing and waning click-through tendency.</em></p>
<p>On closer examination of the resulting plot in the latter figure, it becomes clear that the policies did not settle after one day of training. For one, on inspection of the full span of about eight days of learning, Hybrid LinUCB’s advantage over Disjoint LinUCB gradually diminishes and then reverses into an advantage for the Disjoint version. Also, surprisingly, over the full eight days, the <span class="math inline">\(\epsilon\)</span>-greedy policy goes from the worst to third best policy overall, becoming the best context-free policy—clearly outperforming both context-free UCB policies. Though we intend to further analyze these discrepancies, for now, these results seem to pose questions for two out of three conclusions drawn in the original paper—leaving only the first outcome, the superiority of the contextual LinUCB in comparison to several context-free ones. Underlining the benefits of <code>contextual</code>, as it enabled us to replicate and confirm the original Li et al 2010 paper, and then explore it further: extending <code>Bandit</code> and <code>Policy</code> classes, running simulations in parallel on an offline dataset and plotting and analyzing the results—within 48 hours.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin van Emden.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: '7d3ef95d72d5a68e705ce87f9919b959',
    indexName: 'nth_iteration_labs_contextual',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
